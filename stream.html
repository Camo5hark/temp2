<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            body {
                background-color: black;
                color: white;
            }
            div.section {
                padding-bottom: 20px;
            }
            div#videos {
                width: 640px;
                height: 360px;
                border: 1px solid white;
                overflow: auto;
            }
            li.video {
                margin-bottom: 10px;
                cursor: pointer;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.6.3.slim.min.js" integrity="sha256-ZwqZIVdD3iXNyGHbSYdsmWP//UBokj2FHAxKuSBKDSo=" crossorigin="anonymous"></script>
        <script>
            var indicesFiltered = []
            var indexCurrent

            function filterFormat(filter) {
                return filter.toLowerCase().replace(/[^a-z0-9]/g, "")
            }

            function onkeyupFilter() {
                indicesFiltered = []

                const filter = filterFormat($("input#filter").val().trim())

                $("li.video").each(function(index, video) {
                    if (filterFormat($(video).text()).includes(filter)) {
                        indicesFiltered.push(index)

                        $(video).show()

                        return
                    }

                    $(video).hide()
                })

                localStorage.setItem("filter", $("input#filter").val())
            }

            function setCurrentVideoBgColor(color) {
                $($("li.video").get(indexCurrent)).css("background-color", color)
            }

            function onclickVideos(index) {
                if (index >= 0 && index < $("li.video").length) {
                    setCurrentVideoBgColor("black")

                    indexCurrent = index

                    setCurrentVideoBgColor("blue")

                    $("source#videoSource").attr("src", `/video?index=${indexCurrent}`)
                    $("video#video").get(0).load()

                    if ($("input#autoplay").get(0).checked) {
                        $("video#video").get(0).play()
                    }

                    if ($("input#autoFullscreen").get(0).checked) {
                        $("video#video").get(0).requestFullscreen()
                    }

                    localStorage.setItem("indexCurrent", indexCurrent)
                }
            }

            function onclickAutoplay() {
                localStorage.setItem("autoplay", $("input#autoplay").get(0).checked)
            }

            function onchangeAutoplayMode() {
                localStorage.setItem("autoplayMode", $("select#autoplayMode").val())
            }

            function onclickAutoFullscreen() {
                localStorage.setItem("autoFullscreen", $("input#autoFullscreen").get(0).checked)
            }

            function onclickNext() {
                switch ($("select#autoplayMode").val()) {
                    default:
                    case "inOrder":
                        onclickVideos(indexCurrent + 1)

                        break
                    case "randomAll":
                        $("li.video").get(Math.floor(Math.random() * $("li.video").length)).click()

                        break
                    case "randomFiltered":
                        onclickVideos(indicesFiltered[Math.floor(Math.random() * indicesFiltered.length)])

                        break
                }
            }

            function onendedVideo() {
                if ($("input#autoplay").get(0).checked) {
                    onclickNext()
                }
            }

            function loadStoredValue(selector, key, defaultValue) {
                $(selector).val(localStorage.getItem(key) || defaultValue)
            }

            $(document).ready(function() {
                indexCurrent = localStorage.getItem("indexCurrent") || 0

                loadStoredValue("input#filter", "filter", "")
                loadStoredValue("input#autoplay", "autoplay", false)
                loadStoredValue("select#autoplayMode", "autoplayMode", "inOrder")
                loadStoredValue("input#autoFullscreen", "autoFullscreen", false)
                onkeyupFilter()
                onclickVideos(indexCurrent)
            })
        </script>
    </head>
    <body>
        <div class="section">
            <img src="/splash" width="300" height="300">
        </div>
        <div class="section">
            <div>News:</div>
            <ul>
                <li>Currently no news</li>
            </ul>
        </div>
        <div class="section">
            <form action="javascript:void(0)">
                <label for="filter">Filter:</label>
                <input id="filter" name="filter" type="text" onkeyup="onkeyupFilter()">
            </form>
            <div id="videos">
                <ul>%VIDEOS%</ul>
            </div>
        </div>
        <div class="section">
            <h1 id="title">Video</h1>
            <video id="video" width="640" height="360" controls autoplay onended="onendedVideo()">
                <source id="videoSource" src="" type="video/mp4">
            </video>
            <div>
                <button id="next" onclick="onclickNext()">Next</button>
            </div>
        </div>
        <div class="section">
            <form action="javascript:void(0)">
                <label for="autoplay">Autoplay:</label>
                <input id="autoplay" name="autoplay" type="checkbox" onclick="onclickAutoplay()">
                <select id="autoplayMode" onchange="onchangeAutoplayMode()">
                    <option value="inOrder">In order</option>
                    <option value="randomAll">Random (All)</option>
                    <option value="randomFiltered">Random (Filtered)</option>
                </select>
            </form>
            <form action="javascript:void(0)">
                <label for="autoFullscreen">Auto fullscreen:</label>
                <input id="autoFullscreen" name="autoFullscreen" type="checkbox" onclick="onclickAutoFullscreen()">
            </form>
        </div>
    </body>
</html>